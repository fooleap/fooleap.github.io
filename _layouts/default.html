<!DOCTYPE html>
<html>

{% include head.html %}

    <body>

        {% if page.thumb %}
        {% assign thumbnail = page.thumb | replace:'IMG_PATH', site.IMG_PATH %}
        {% else %}
        {% if page.content contains site.IMG_PATH %}
        {% assign images = page.content | split:'<img src="' %}
        {% for image in images %}
        {% if image contains site.IMG_PATH %}
        {% assign thumbnail = image | split:"?imageView" | first | split: '"' | first | remove: "_640" %}
        {% break %}
        {% endif %}
        {% endfor %}
        {% else %}
        {% assign thumbnail =  site.IMG_PATH | append: "/avatar.jpg" %}
        {% endif %}
        {% endif %}
        <div class="page-thumb">
            <img src="{{ thumbnail | append: '?imageView2/1/w/300/h/300/q/90'}}" />
        </div>

{% include nav.html %}

        <main class="page-main">

            <header class="page-header">
                <hgroup class="page-hgroup">
                    <h1 class="page-title"><a class="page-title-link" href="{% if page.title %}{{ page.url }}{% else %}{{ site.home }}{% endif %}">{% if page.title %}{{ page.title }}{% else %}{{ site.title }}{% endif %}</a></h1>
                    <h2 class="page-subtitle">
                    {% if page.date %}
                    <time class="post-date" datetime="{{ page.date | date: "%Y-%m-%d" }}">{{ page.date | date: "%Y 年 %m 月 %d 日" }}</time>
                        <span class="post-count">本文 {{ page.content | strip_html | strip_newlines | size }} 字，阅读全文约需 {{ page.content | strip_html | strip_newlines | size | divided_by: 400 | plus: 1 }} 分钟</span>
                    {% elsif paginator %}
                        {{ site.description }}
                    {% else %}
                        {{ page.description }}
                    {% endif %}
                    </h2>
                </hgroup>
            </header>
            <section class="page-content">

                {% if page.style or page.js %}

                {% if page.style and page.js != true %}
                {{ content_style[0] }}
                {{ content_style[2] }}
                {% endif %}

                {% if page.js and page.style != true %}
                {{ content_js[0] }}{{ content_js[2] }}
                {% endif %}

                {% if page.style and page.js  %}
                {{ content_style[0] }}{{ content_js[2] }}
                {% endif %}

                {% else %}

                {{ content }}

                {% endif %}

            </section>

            <footer class="page-footer">
                <small>&copy; 2011-{{ site.time | date: '%Y' }} Jekyll & Disqus | 粤ICP备15090659号-1</small>
            </footer>

        </main>

        <script src="//res.wx.qq.com/open/js/jweixin-1.0.0.js"></script>
        <script src="/assets/js/raphael.min.js"></script>
        <script src="/assets/js/main.js"></script>

        {% if page.scripts %}
        {% for script in page.scripts %}
        <script src="{{ script }}"></script>
        {% endfor %}
        {% endif %}

        {% if page.js %}
        <script>{{ content_js[1] }}script>
        {% endif %}
    </body>
</html>
